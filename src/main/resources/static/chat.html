<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì§„ê²©ì˜ ê±°ì¸ WebSocket Chat</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <style>
        body { font-family: "Noto Sans KR", sans-serif; padding: 20px; background: #f8f9fa; }
        h2 { color: #333; }
        input, button { font-size: 16px; padding: 8px; border-radius: 8px; border: 1px solid #ccc; }
        button { background-color: #007bff; color: white; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        ul { list-style: none; padding: 0; }
        li { background: white; padding: 10px; margin: 5px 0; border-radius: 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        #nickname { font-weight: bold; color: #007bff; }
    </style>
</head>
<body>
<h2>ğŸ—¡ï¸ ì§„ê²©ì˜ ê±°ì¸ ì±„íŒ…ë°©</h2>

<p>ë‹¹ì‹ ì˜ ë‹‰ë„¤ì„: <span id="nickname"></span></p>

<input type="text" id="message" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" onkeydown="if(event.key==='Enter') sendMessage()">
<button onclick="sendMessage()">ë³´ë‚´ê¸°</button>

<ul id="chat"></ul>

<script>
    // âš”ï¸ ì§„ê²©ì˜ ê±°ì¸ ëœë¤ ë‹‰ë„¤ì„ ìƒì„±
    const emojis = ['ğŸ¦', 'ğŸ¯', 'ğŸº', 'ğŸ¦Š', 'ğŸ‰', 'ğŸ»', 'ğŸ²', 'ğŸµ'];
    const names = [
        'ì—ë Œ', 'ë¦¬ë°”ì´', 'ë¯¸ì¹´ì‚¬', 'ì•„ë¥´ë¯¼', 'í•œì§€',
        'ì‚¬ìƒ¤', 'ì½”ë‹ˆ', 'ì—ë¥´ë¹ˆ', 'ì§€í¬', 'íˆìŠ¤í† ë¦¬ì•„',
        'ë¼ì´ë„ˆ', 'ë² ë¥´í†¨íŠ¸', 'íŒŒë¡', 'ì¼€ë‹ˆ', 'ë‹', 'ë§ˆë¥¼ë¡œ'
    ];
    const emoji = emojis[Math.floor(Math.random() * emojis.length)];
    const name = names[Math.floor(Math.random() * names.length)];
    const nickname = emoji + ' ' + name;
    document.getElementById('nickname').textContent = nickname;

    // ğŸ•¸ï¸ WebSocket ì—°ê²°
    const socket = new SockJS('/ws');
    const stomp = Stomp.over(socket);

    stomp.connect({}, () => {
        console.log('âœ… ì„œë²„ì™€ ì—°ê²°ë¨');
        stomp.subscribe('/topic/messages', (msg) => {
            const data = JSON.parse(msg.body);
            const li = document.createElement('li');
            li.textContent = data.sender + ': ' + data.content;
            document.getElementById('chat').appendChild(li);
        });
    });

    // âœ‰ï¸ ë©”ì‹œì§€ ì „ì†¡
    function sendMessage() {
        const msg = document.getElementById('message').value.trim();
        if (msg === '') return;
        stomp.send('/app/send', {}, JSON.stringify({ sender: nickname, content: msg }));
        document.getElementById('message').value = '';
    }
</script>
</body>
</html>
